\documentclass{article}

\usepackage{fontspec}
\setmainfont[Ligatures=TeX]{Linux Libertine O}

\usepackage{natbib}% Citation support using natbib.sty
\usepackage{graphicx}
\usepackage{amsmath}

\bibpunct[, ]{(}{)}{;}{a}{}{,}% Citation support using natbib.sty
\renewcommand\bibfont{\fontsize{10}{12}\selectfont}% Bibliography support using natbib.sty

\title{Оптимизација на производство на Електрична Енергија}

\date{2018-01-16}

\author{Благој Атанасовски}

\begin{document}
\begin{figure}
\includegraphics[scale=.4]{image}
\end{figure}

\maketitle
\newpage

\section{Претставување на проблемот}
Да претпоставиме дека на територијата на една земја, постојат $N$ населени места и $M$ електрани. Секое од населените места во даден момент има потрошувачка/потреба од $ Potrosuvacka[i] $ MWh електрична енергија каде $ 0 < i \leq N $ . Секоја од електраните има можност во даден момент да произведе максимум $MaxProiz[j]$ MWh електрична енергија (термо електрана на јаглен) каде $0 < j \leq M$. Електраните може да го контролираат производството на енергија од $0\% до 100\%$. За секоја од електраните имаме $MaxCena[j]$ што ја претставува цената да работи електраната во полн капацитет, цената е линеарно зависна од капацитетот со кој работи електраната со што на капацитет 0\% цената е 0. Населено место е поврзано со далековод со барем една од електраните, максимум со сите. 

За секој од далеководите помеѓу населено место $i$ и електрана $j$ познат е коефициент на загуба, $Zaguba[i][j]$ кој го дава процентот на изгубена моќност, при што $0 \leq Zaguba[i][j] < 100 $, и доколку $Zaguba[i][j] = 0$ тогаш нема далековод кој ги поврзува i и j. Органичувања кои важат се:
\begin{itemize}
\item Електраните под полн капацитет можат да ги задоволат потребите на населените места
\item Поставеноста на далеководите гарантира дека секогаш ќе може да се испорача енергија до сите населени места
\end{itemize}

Целта е, за дадени:
\begin{itemize}
\item Моќност на електричните централи
\item Потрошувачка на населните места
\item Должината на далеководите кои ги поврзуваат електраните со населените места
\item Загубата на секој од далеководите
\end{itemize}

Да се најде капацитетот со кој треба да работат електраните, така што цената за производство и транспорт на електричната енергија ќе биде што е можно понизок.

\section{Решение}

Зададениот проблем е од оптимизациска природа. Со тоа што целта е да се минимизира цената за производство на електрична енергија при што цената ја дефинираме како
\[cena = \sum_{i=1}^{M}OdbranKapacitet[i]\cdot MaxCena[i]\]
каде $OdbranKapacitet[j]$ е капацитетот со кој треба да работи електраната $j$ во решението. Ако дефинираме $Isporaka[i][j]$ = Процентот од енергијата генерирана во електраната $j$ испорачана до населено место $i$, тогаш важат ограничувањата:

\[\forall i, 1 \geq i \geq N,\]
\[\sum_{j=1}^{M} Isporaka[i][j] \cdot OdbranKapacitet[j] \cdot MaxProiz[j] \cdot Zaguba[i][j] \geq Pot[i]\]
\[\forall j, 1\geq j \geq M,\]
\[\sum_{i=1}^{N} Isporaka[i][j] \cdot OdbranKapacitet[j] \cdot MaxProiz[j] \cdot Zaguba[i][j] \leq MaxProiz[j] \]
\[ 0 \leq Isporaka[i][j] \leq 100 \]

\section{Методологија за оценување на решенијата}
Да се најде brute-force решение со испробување на сите комбинации претставува проблем со $O(100^{n \cdot n})$  комплексност, бидејќи за секоја вредност од матрицата $Isporaka$ има 100 вредности. 

За лесна проверка, ќе бидат земени:
\begin{enumerate}
\item Тривијални примери
	\begin{enumerate}
	\item 1 електрана со n населени места, сите се поврзани, еднаква загуба
	\item 1 населено место со m електрани, сите се поврзани, еднаква загуба
	\item 1 населено место со m електрани, некои се неповрзани, еднаква загуба
	\end{enumerate} 
\item Едноставни примери
	\begin{enumerate}
	\item 2 населени места, 2 електрани, сите се поврзани меѓу себе, иста загуба
	\item 3 населени места, 3 електрани, сите се поврзани, различна загуба
	\item мали m и n, постојат неповрзани населени места со електрани, различна загуба
	\end{enumerate}
\end{enumerate}

Дополнително ќе бидат следени влијанието на:
\begin{itemize}
\item ратата на мутација
\item ратата на вркстување
\item големината на популацијата
\end{itemize}

врз пронајдениот минимум и брзината на конвергенција.

\subsection{1.a}
Во примерот 1.a цел на оптимизација е распределбата на електрична енергија од една електрана, кон n населени места. Сите населени места се поврзани со електраната и процентот на загуба на енергија е еднаков за сите.

Влезни аргументи: 
\begin{itemize}
\item $m = 1$
\item $n = 10$
\item $Potrosuvacka = \begin{bmatrix} 10 & 20 & 50 & 100 & 30 & 40 & 100 & 5 & 10 & 20\end{bmatrix}$
\item $MaxProiz = \begin{bmatrix} 500 \end{bmatrix}$
\item $MaxCena = \begin{bmatrix} 1000 \end{bmatrix}$
\item $\forall i 1 \leq i \leq n, \forall j 1 \leq j \leq m, Zaguba[i][j] = 10$

\end{itemize}

Очекуван излез:
\begin{itemize}
\item $PredlogDistribucija = \begin{bmatrix} 3 & 5 & 12 & 23 & 7 & 9 & 23 & 2 & 3 & 5\end{bmatrix}$
\item $ OdbranKapacitet = \begin{bmatrix} 92 \end{bmatrix}$
\item $cena = 0.92 \cdot 1000 = 920 $
\end{itemize}

\subsection{1.b}
Во примерот 1.b цел на оптимизација е распределбата на електрична енергија до 1 населено место а на располагање се m електрани. Сите населени места се поврзани со електраната и процентот на загуба на енергија е еднаков за сите.

Влезни аргументи: 
\begin{itemize}
\item $m = 5$
\item $n = 1$
\item $Potrosuvacka = \begin{bmatrix} 100 \end{bmatrix}$
\item $MaxProiz = \begin{bmatrix} 20 & 30 & 10 & 50 & 100\end{bmatrix}$
\item $MaxCena = \begin{bmatrix} 10 & 20 & 5 & 10 & 120\end{bmatrix}$
\item $\forall i 1 \leq i \leq n, \forall j 1 \leq j \leq m, Zaguba[i][j] = 10$

\end{itemize}

Очекуван излез:
\begin{itemize}
\item $PredlogDistribucija = \begin{bmatrix} 100 & 98 & 98 & 100 & 1 \end{bmatrix}$
\item $OdbranKapacitet = \begin{bmatrix} 100 & 98 & 98 & 100 & 1\end{bmatrix}$
\item $cena = 10 + 20 + 5 + 10 + 0.01 \cdot 120 = 46.2 $
\end{itemize}

\subsection{1.c}

Во примерот 1.c цел на оптимизација е распределбата на електрична енергија до 1 населено место а на располагање се m електрани. Некои од електраните не се поврзани со електраната и процентот на загуба е еднаков за сите.

Влезни аргументи: 
\begin{itemize}
\item $n = 1$
\item $m = 5$
\item $Potrosuvacka = \begin{bmatrix} 100 \end{bmatrix}$
\item $MaxProiz = \begin{bmatrix} 20 & 30 & 10 & 50 & 100 \end{bmatrix}$
\item $MaxCena = \begin{bmatrix} 100 & 5 & 50 & 10 & 120 \end{bmatrix}$
\item $Zaguba[1][1] = 10, Zaguba[1][3] = 10, Zaguba[1][5] = 10$
\item $Zaguba[1][2] = 0, Zaguba[1][4] = 0$ т.е. нема довод
\end{itemize}

Очекуван излез:
\begin{itemize}
\item $PredlogDistribucija = \begin{bmatrix}  10 & 0 & 100 & 0 & 100 \end{bmatrix}$
\item $OdbranKapacitet = \begin{bmatrix} 10 & 0 & 100 & 0 & 100\end{bmatrix}$
\item $cena = 0.1 \cdot 100 + 0 + 50 + 0 + 100 = 234 $
\end{itemize}

\subsection{2.a}
Во примерот 2.a цел на оптимизација е распределба на електрична енергија до 2 населени места од 2 електрани, и двете електрани се поврзани до 2те населени места и имаат иста загуба. 

Влезни аргументи:
\begin{itemize}
\item $n = 2$
\item $m = 2$
\item $Potrosuvacka = \begin{bmatrix} 150 & 200\end{bmatrix}$
\item $MaxProiz = \begin{bmatrix} 250 & 200 \end{bmatrix}$
\item $MaxCena = \begin{bmatrix} 120 & 50 \end{bmatrix}$
\item $Zaguba = \begin{bmatrix} 10 & 10\\ 10 & 10 \end{bmatrix}$
\end{itemize}

Очекуван излез:
\begin{itemize}
\item $PredlogDistribucija = \begin{bmatrix} 0 & 84 \\ 69 & 26 \end{bmatrix}$
\item $OdbranKapacitet = \begin{bmatrix} 69 & 100 \end{bmatrix}$
\item $cena = 0.69 * 120 + 1 * 50 = 132.8$
\end{itemize}

\subsection{2.b}
Во примерот 2.b цел на оптимизација е распределба на електрична енергија до 4 населени места од 4 електрани, секое од населените места има довод од само 2 електрани. 

Влезни аргументи:
\begin{itemize}
\item $n = 4$
\item $m = 4$
\item $Potrosuvacka = \begin{bmatrix} 150 & 200 & 500 & 300 \end{bmatrix}$
\item $MaxProiz = \begin{bmatrix} 250 & 300 & 1000 & 400\end{bmatrix}$
\item $MaxCena = \begin{bmatrix} 120 & 50 & 400 & 100 \end{bmatrix}$
\item $Zaguba = \begin{bmatrix} 10 & 10 & 0 & 0 \\ 0 & 10 & 10 & 0 \\ 0 & 0 & 10 & 10 \\ 10 & 0 & 0 & 10 \end{bmatrix}$
\end{itemize}
Очекуван излез:
\begin{itemize}
\item $PredlogDistribucija = \begin{bmatrix} 0 & 56 & 0 & 0 \\ 0 & 41 & 10 & 0 \\ 0 & 0 & 50 & 14 \\ 0 & 0 & 0 & 84 \end{bmatrix}$
\item $OdbranKapacitet = \begin{bmatrix} 0 & 97 & 60 & 98 \end{bmatrix}$
\item $cena = 0 \cdot 120 + 0.97 \cdot 50 + 0.6 \cdot 400 + 0.98 \cdot 100  = 386.5$
\end{itemize}


\subsection{2.c}
Во примерот 3.c цел на оптимизација е распределба на електрична енергија до 6 населени места од 4 електрани, секое од населените места има довод од барем 2 електрани. 

Влезни аргументи:
\begin{itemize}
\item $n = 7$
\item $m = 4$
\item $Potrosuvacka = \begin{bmatrix} 100 & 100 & 100 & 100 & 100 & 100 & 100\end{bmatrix}$
\item $MaxProiz = \begin{bmatrix} 300 & 150 & 300 & 150\end{bmatrix}$
\item $MaxCena = \begin{bmatrix} 100 & 80 & 300 & 150 \end{bmatrix}$
\item $Zaguba = \begin{bmatrix} 0 & 10 & 10 & 10 \\ 10 & 0 & 10 & 10 \\ 10 & 10 & 0 & 10 \\ 10 & 10 & 10 & 0 \\ 0 & 0 & 5 & 5 \\ 5 & 5 & 0 & 0 \\ 10 & 10 & 10 & 10\end{bmatrix}$
\end{itemize}
Очекуван излез:
\begin{itemize}
\item $PredlogDistribucija = \begin{bmatrix} 0 & 0 & 38 & 0 \\ 0 & 0 & 38 & 0 \\ 0 & 0 & 0 & 75 \\ 38 & 0 & 0 & 0 \\ 0 & 0 & 24 & 23 \\ 36 & 0 & 0 & 0 \\ 26 & 21 & 0 & 2 \end{bmatrix}$
\item $OdbranKapacitet = \begin{bmatrix} 100 & 21 & 100 & 100 \end{bmatrix}$
\item $cena = 1 * 100 + 0.21 * 80 + 1 * 60 + 1 * 40 = 216.8$
\end{itemize}


\section{Имплементација на решението}

Решенијата се имплементирани во програмскиот јазик Python 2.7, со користење на библиотеката PyEvolve. Оваа блиблиотека вградува во себе готови имплементации на еволутивни алгоритми и дозволува нивно извршување со едноставно менување на параметрите. Во истата библиотека постојат веќе креирани едноставни репрезентации на хромозоми (1д низа, 2д низа, бинарен стринг) и оператори за нив, но овозможува и креирање на свои оператори.

\subsection{Генетски алгоритам, варијанта 1}

Првата имплементација претставува наивен обид ограничувањата дадени во описот на проблемот да се претстават само преку функцијата на целта, т.е. доколку некое од ограничувањата не исполнето тогаш цената се „казнува“ неколкукратно. 

\subsubsection{Претставување на хромозомите}

Хромозомите ги претставуваме како 2 димензионална матрица, ќе ја наречеме $PredlogDistribucija$ со $N$ број на редови, и $M$ број на колони. $PredlogDistribucija[i][j], 0 < i \leq N, 0 < j < M$ го претставува делот од производството на електраната $j$ (изразено во проценти) кој се доставува на населеното место $i$, $ \forall i, \forall j, 0 \leq PredlogDistribucija[i][j] \leq 100$. Од иницијалнито претставување на решението 
\[ \forall i, OdbranKapacitet[i] = \sum_{j=1}^{N} PredlogDistribucija[i][j]\]

На иницијализација вредностите на секое место во матрицата се поставуваат по случаен избор со рамномерна распределба.

\subsubsection{Мутација}

Операторот за мутација како аргумент прима еден хромозом и ратата на мутација со која е стартуван алгоритмот, потоа зависно од ратата на мутација бира колку од вредностите на матрицата на хромозомот ќе ги мутира т.е ќе ги постави на случајна вредност помеѓу 0 и 100.
 
\subsubsection{Вкрстување}

Операторот за вкрстувањето добива како аргумент 2 хромозоми, и за секој од елементите во матрицата на хромозомите на иста позиција постои 50\% да бидат заменети меѓу двете единки. 
 
\subsubsection{Функција на цел}

Функцијата на цел на влез прима еден хромозом и ја пресметува цената за производството на електричната енергија. Прво се пресметува колку изнесува цената според одбраниот капацитет на секоја од електраните 
\[ cena = \sum_{j=1}^{M} (maxCena[j] \cdot MaxProiz[j] \cdot  \sum_{i=1}^{N} OdbranKapacitet[i][j] )\]
потоа, доколку не е исполнето некое од ограничувањата се казнува цената со множење, притоа:
\begin{itemize}
\item Доколку електрана дистрибуира енергија до населено место до кое нема далековод, ($Zaguba[i][j] = 0$ но $OdbranKapacitet[i][j] \neq 0$) цената се множи со производот на цената на најскапата електрана и големината на прекорачувањето)  
\item Доколку електрана треба да произведе повеќе енергија отколку што е нејзиниот максимален капацитет ($OdbranKapacitet[i][j] > 100$), цената се множи со производот на цената на најскапата електрана и големината на прекорачувањето 
\item Доколку населено место добива помалку енергија од својата побарувачка ($ \forall i, \sum_{j=1}^{M} MaxProiz[j] \cdot OdbranKapacitet[i][j] \cdot Zaguba[i][j] < Potrosuvacka[i]$), цената се множи со производот на цената на најскапата електрана и недостатокот на енергија 
\end{itemize}

Алгоритмот за се обидува да ја минимизира цената, притоа казните на цената се земаат релативно од влезните податоци (цена на најскапа електрана). Казните се променливи и во однос на големината на грешката, прекорачување на капацитетот на една електрана за 1\% се казнува пропорционално помалку во однос на прекорачување на капацитетот за 20\% или 30\%.

\subsubsection{Резултати}
 
Резултатите ќе ги прикажеме во табела за секоја од категоријата на решенија, споредени со очекуваните резултати. Во табелата дадена во оваа секција ги прикажуваме резултатите добиени за 10000 генерации со 1000 единки во популацијата. Притоа алгоритмот работеше со рата на мутација 0.5 и рата на вкрстување 0.5. Потоа ќе ги дискутираме добиените резултати и ќе наведеме како влијание имала промената на разни параметри на алгоритмот. 

\begin{table}[h!]
\centering
\begin{tabular}{||c c c||} 
 \hline
 Проблем & Добиено решение & Очекувано решение \\ [0.5ex]
 \hline\hline
 1.a & 920 & 920\\ 
 1.b & 46.9 & 46.2 \\
 1.c & 176 & 160 \\
 2.a & 141.2 & 132.8 \\
 2.b & 456 & 386.5 \\
 2.c & N/A & 216.8 \\ [1ex] 
 \hline
\end{tabular}
\caption{Споредба на добиени резултати со очекуваните, 1000 единки, во 10000 генерации}
\label{table_rez_ver1}
\end{table}
\bibliographystyle{tfcad}
\bibliography{qqp}

Од табела \ref{table_rez_ver1} може да се забележи дека за најтривијалните проблеми, наивното генетско решение дава добри резултати. Но со усложнување на проблемот, воведувањето на повеќе електрани кои дистрибуираат кон повеќе населени места со променливи загуби, веќе резултираат со значителни отстапувања од очекуваните решенија. Во примерите 2.b и 2.c очекуваните решенија исто така не се оптимални, туку се добиени на алчен пристап и служат само за споредба. Но иако такви, првата верзија на генетскиот алгоритам не дава решенија блиски до нив. За најсложениот пример во 2.c генетскиот алгоритам не успеа да даде решение кое не ги прекршува ни едно од дадените ограничувања (дури и по 15000 генерации со 1000 единки). 

Дополнително беше тестирано и влијанието на промената на: ратата на мутација, ратата на вкрстување, бројот на генерации и бројот на единки. Од табелата во апендиксот може да се забележи дека за оваа имплементација на алгоритмот, рата на мутација под 0.4 и над 0.6 влијаеше забележително негативно на резултатите, освен во наједноставните случаи. Ратата на вкрстување имаше многу мало влијание на резултатите. За примерите од групата 1, немаше влијание бројот на единки, и доволни беа 100 единки да дадат добар резултат, но за примерите од втората група (особено 2.b) тестовите со помалку од 1000 единки не даваа резултати кои ги задоволуваа ограничувањата. На сличен начин влијаеше и бројот на генерации, кај тривијалните примери, доволно беа и 1000 генерации, додека кај  2.c примерот ни 15000 генерации не успеаа да дадат здоволително решение.

\subsection{Генетски алгоритам, варијанта 2}

Во втората варијанта на алгоритмот ќе го ограничиме начинот на составување на хромозомите, со тоа што уште при иницијализацијата на единките некои од ограничувањата ќе бидат запазени. Исто така при вкрстувањето ќе биде запазено потомокот да ги задоволува истите ограничувања.

\subsubsection{Претставување на хромозомите}

Хромозомите ги претставуваме како 2 димензионална матрица, ќе ја наречеме $PredlogDistribucija$ со $N$ број на редови, и $M$ број на колони. $PredlogDistribucija[i][j], 0 < i \leq N, 0 < j < M$ го претставува делот од производството на електраната $j$ (изразено во проценти) кој се доставува на населеното место $i$, $ \forall i, \forall j, 0 \leq PredlogDistribucija[i][j] \leq 100$. Од иницијалнито претставување на решението 
\[ \forall i, OdbranKapacitet[i] = \sum_{j=1}^{N} PredlogDistribucija[i][j]\]

На иницијализација вредностите на секое место во матрицата се поставуваат по случаен избор со рамномерна распределба.

\subsubsection{Мутација}

Операторот за мутација како аргумент прима еден хромозом и ратата на мутација со која е стартуван алгоритмот, потоа зависно од ратата на мутација бира колку од вредностите на матрицата на хромозомот ќе ги мутира т.е ќе ги постави на случајна вредност помеѓу 0 и 100.
 
\subsubsection{Вкрстување}

Операторот за вкрстувањето добива како аргумент 2 хромозоми, и за секој од елементите во матрицата на хромозомите на иста позиција постои 50\% да бидат заменети меѓу двете единки. 
 
\subsubsection{Функција на цел}

Функцијата на цел на влез прима еден хромозом и ја пресметува цената за производството на електричната енергија. Прво се пресметува колку изнесува цената според одбраниот капацитет на секоја од електраните 
\[ cena = \sum_{j=1}^{M} (maxCena[j] \cdot MaxProiz[j] \cdot  \sum_{i=1}^{N} OdbranKapacitet[i][j] )\]
потоа, доколку не е исполнето некое од ограничувањата се казнува цената со множење, притоа:
\begin{itemize}
\item Доколку електрана дистрибуира енергија до населено место до кое нема далековод, ($Zaguba[i][j] = 0$ но $OdbranKapacitet[i][j] \neq 0$) цената се множи со производот на цената на најскапата електрана и големината на прекорачувањето)  
\item Доколку електрана треба да произведе повеќе енергија отколку што е нејзиниот максимален капацитет ($OdbranKapacitet[i][j] > 100$), цената се множи со производот на цената на најскапата електрана и големината на прекорачувањето 
\item Доколку населено место добива помалку енергија од својата побарувачка ($ \forall i, \sum_{j=1}^{M} MaxProiz[j] \cdot OdbranKapacitet[i][j] \cdot Zaguba[i][j] < Potrosuvacka[i]$), цената се множи со производот на цената на најскапата електрана и недостатокот на енергија 
\end{itemize}

Алгоритмот за се обидува да ја минимизира цената, притоа казните на цената се земаат релативно од влезните податоци (цена на најскапа електрана). Казните се променливи и во однос на големината на грешката, прекорачување на капацитетот на една електрана за 1\% се казнува пропорционално помалку во однос на прекорачување на капацитетот за 20\% или 30\%.

\end{document}